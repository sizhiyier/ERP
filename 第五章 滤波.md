# 滤波

## 为什么一定要滤波

+ 奈奎斯特定理告诉我们，只要采样频率不小于连续模拟信号中最高频率的两倍，就可以在不损失任何信息的前提下，把该模拟信号转变为一组离散信号。如果原始信号中包含了频率超过两倍采样频率的信号，这些非常高的频率会在采样数据中以低频伪迹的形式表现出来（被称为混叠）。因此，EEG放大器中一般内置了用以过滤高频的滤波器，而他们通常被设定为过滤那些高于二分之一采样率的频率。在实际应用中，采样频率至少应该为截止频率的三倍。
+ 滤波的第二个目的是降低噪声。基本思路是，EEG中既包含信号也包含噪声，而其中一些噪声在频率上与信号的差异较大，因此可以通过衰减特定频率的方法来降低这些噪声。

## 滤波须知

​		任何波形都可以被分解为一组不同频率和相位的正弦波，而把这些正弦波简单相加后又会重建出原波形。通常对滤波器的描述体现了其衰减或通过各种不同频率的能力，最常见的类型包括。

+ 低通滤波器 衰减高频而通过低频
+ 高通滤波器 衰减低频而通过高频
+ 带通滤波器 同时衰减高频和低频，只通过中间的频率
+ 凹陷滤波器 衰减某个很窄的频段，通过其他所有频段

### 滤波器与振幅衰减

<img src="C:\Users\XUE\AppData\Roaming\Typora\typora-user-images\image-20221115130134687.png" alt="image-20221115130134687" style="zoom:67%;" />

​		滤波器的属性一般以其转换函数来表示，该函数用来说明滤波器的输入是如何被转换为滤波器的输出的。转换函数可以分解为两个成分，其中频率响应函数用来说明滤波器如何改变各频率的相位。如图A所示显示了一个半振幅截止频率为30Hz的滤波器的频率响应函数，以及该滤波器对时间ERP波形中60Hz噪声的过滤效果。

​		在ERP研究中，滤波器常常用其**半振幅截止频率**来表示，既振幅衰减了50%的频率（有时，截止频率用半能量而不是半振幅来表示，能量剩余50%对应于振幅剩余71%）。但滤波器对低于半振幅截止频率的频率也会有很多衰减，而对高出半振幅截止频率的很多频率却没有完全衰减。尽管如此，该滤波器还是能有效地滤掉ERP波形中的60Hz噪声，同时保持波形的基本形状不变。

​		图B显示了一个半振幅截止频率约为2.5Hz的高通滤波器的频率响应函数，及其对一个ERP波形的过滤效果。如图所示，一个大而宽的正向成分的振幅在该滤波器的作用下大大减小，而早期高频成分的振幅则没有减少多少。但还是受到了一些影响，并且在波的开头和结尾产生了一些小的伪峰，这引出了本节最重要的观点**滤波器会改变ERP成分的振幅和时间过程，以及增加伪峰的方式，导致ERP波形显著失真**		

### 滤波如何使数据失真

​		**时域上的精确与频域上的精确成逆相关**

![image-20221115133702327](C:\Users\XUE\AppData\Roaming\Typora\typora-user-images\image-20221115133702327.png)

​		换句话说，对一个ERP波形的频率限定得越严格（即过滤掉很大的频率范围），该ERP波形就会在时间上展开得越多。如A所示，与未滤波相比，经过低通滤波后ERP波形要更早开始更晚结束。低通滤波器几乎总是引起波形这种“拖尾效应”，导致ERP成分和实验效应在起始时间和结束时间上失真。因此，如果经低通滤波后一个实验效应的起始时间是120 ms，那么实际的起始时间可能是150ms。

​		如B所示，高通滤波器也可能引起ERP波形在时域展开，但这时的失真还包括一组上下振荡的正弦波。因此，该滤波器不仅引发了远早于实际兴奋起始时间的兴奋伪迹，还引发了波形振荡。这种失真也可能会导致原本应体现在某极性的成分上的实验效应，看起来却表现在一个比较早的但极性相反的成分上。比如原始波形中的N1增大可能会在滤波后的波形中表现为P1振幅的增大。

​		与图5.1B只会在每个波形的结尾处产生一个极性相反的虚假峰相比，图5.2B产生多峰振荡，这是因为5.2C中滤波器频率响应函数引起的。与5.1B中滤波器在最低截止频率与最高通过频率之间有一个相对平缓的过渡不同，5.2B的滤波器完全过滤掉了较宽范围的低频，而对较宽范围的额高频则骤然允许通过。这意味着5.2B的滤波器在频率特性上要比5.1B的滤波器更精确，这不由得让我们想起了之前介绍的频域精确与时域精确成逆相关的原则。因此，虽然看起来滤波器在频率响应函数上有非常陡峭的截止特性是很理想的，但与平缓的截止特性相比，陡峭的截止特性往往意味着滤波器会对ERP波形产生更严重的失真。

### 一些建议

1. 汉森原理 干净的数据是无可替代的

​		低通滤波的截止频率应设置在采样率的三分之一到四分之一。对于高度合作的被试，推荐使用0.01Hz的截止频率进行高通滤波，甚至可以完全不进行高通滤波（这称为DC记录），但这时皮肤电和其他一些慢伪迹可能会产生难以接受的噪声。对于一些不太配合的被试（病人或者孩子），可以采用高一些的截止频率，比如0.05甚至0.1。这类被试的问题在于他们可能会动的比较厉害，这会导致电压基线的改变，但如果采用较高的高通截止频率，要意识到这将在一定程度上扭曲你的数据，并降低低频成分（如P3/N400）的振幅。

2. 避免使用凹陷滤波器（也称线频滤波器）来降低线频噪声。在第三章已经介绍了很多方法来防止线频噪声。
3. 尽量不要使用高通滤波

## 频域滤波

​		理解滤波的关键在于理解时域和频域的关系

<img src="C:\Users\XUE\AppData\Roaming\Typora\typora-user-images\image-20221115144136115.png" alt="image-20221115144136115" style="zoom:67%;" />

​		如图A所示，ERP在时域上的表征，是一副标出每个时刻点上的电压的图形；ERP在频域上的表征，是一副标出每个频率上的振幅（及相位）的图形，二者可以通过傅里叶进行转换。

​	从傅里叶分析的角度，你可以把滤波理解为下面的三步

1. 把时域的ERP波形转换为频域表征
2. 把频域表征里要滤掉的频率范围设为0
3. 把更改后的频域表征再转换为时域表征

​		具体来说，与简单地把一部分频率设为零同时保留其他频率相比，从完全过滤到完全不过滤之间进行逐渐的过渡是更好的方法。体现对频率逐渐调制的函数被称为**频率响应函数**。频率响应函数包含了对应的调制因子用以表示该频率通过滤波器的程度（1完全无损，0完全滤去，中间数值部分过滤），频率响应函数应用于第二步。

​		图5.3显示了这种滤波方法可以看出大部分能量都集中在20Hz区域，但在60Hz有一个脉冲，对应于时域波形的振荡噪声，C是一个滤波器的频率响应函数。

### 频域表征的问题

​		时域的波形在傅里叶变换中被表征为一组持续时间无限的正弦波之和，而瞬时的ERP波形在持续时间上是有限的。我们考虑一个极端的例子：只过滤掉ERP波形中频率为5Hz的活动。完全去除ERP波形中5Hz成分相对于先计算频域中5Hz处的振幅和相位，然后从时域ERP波形中减去一个相同振幅和相位的正弦波。减去这个持续时间无限的正弦波后，所得 的ERP波形将在那些原本水平的时间范围内（例如刺激前）出现一个5Hz振荡。这是有悖于直觉的，因为对5Hz的过滤反而导致了刺激前阶段的5Hz振荡，不仅如此，这种刺激前振荡还反应了一种不可能的状态，因为对刺激的反应不可能是刺激前发生的。

​		本章开始介绍过，理解滤波产生的数据失真的一个重要原则是，信号在时域上的展开与频域上的展开呈现逆相关。在时间上集中的信号在频率上分布会很广，反之亦然，比如频域内某个单个尖锐脉冲信号在时域内表现为一个持续时间无限的正弦波。由于这种时域和频域的逆相关，那些严格限定频率的看不清必然会在时间上展开信号，滤波器在频域内范围限定得越窄，在时间上对信号的展开就越宽。因此，如果只过滤单一频率，那么将导致滤波后的波形在时间上无限展开。

## 时域滤波

<img src="C:\Users\XUE\AppData\Roaming\Typora\typora-user-images\image-20221115155330595.png" alt="image-20221115155330595" style="zoom:67%;" />

​		要描述时域内滤波，我们先来介绍一种削弱高频噪声的常识性方法：把一时刻点的电压与其临近时刻点的电压进行迭加平均。换句话说，n时刻点出的过滤后的电压等于未过滤时刻n-1、n和n+1时刻电压的平均。图B显示了对A应用这种滤波器的结果。如果要过滤更宽的频率范围，你只需要简单地迭加平均更多的时刻点即可。图C显示了迭加平均7个时刻点的结果，与图B所比，高频信号得到了更多的过滤，这种方法可以用以下这个公式表示
$$
fERP_i = \sum_{j=-n}^{n}{\omega}{ERP}_{i+j}
$$
​		fERP~i~是滤波后i时刻点的ERP波形；ERP~i~

